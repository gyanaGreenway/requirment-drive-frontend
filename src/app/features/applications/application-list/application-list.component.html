<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">
      <i class="bi bi-file-earmark-text me-2"></i>Job Applications
    </h2>
    <button class="btn btn-primary" (click)="createApplication()">
      <i class="bi bi-plus-circle me-2"></i>Create Application
    </button>
  </div>

  <!-- Filters Card -->
  <div class="card mb-4">
    <div class="card-header bg-light">
      <h5 class="mb-0">
        <i class="bi bi-funnel me-2"></i>Filters & Sorting
      </h5>
    </div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Status</label>
          <select class="form-select" [(ngModel)]="filter.status" (change)="onFilterChange()">
            <option [ngValue]="undefined">All Statuses</option>
            <option *ngFor="let status of statusOptions" [ngValue]="status.value">{{ status.label }}</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Job</label>
          <select class="form-select" [(ngModel)]="filter.jobId" (change)="onFilterChange()">
            <option [value]="undefined">All Jobs</option>
            <option *ngFor="let job of jobs" [value]="job.id">{{ job.title }}</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Candidate</label>
          <select class="form-select" [(ngModel)]="filter.candidateId" (change)="onFilterChange()">
            <option [value]="undefined">All Candidates</option>
            <option *ngFor="let candidate of candidates" [value]="candidate.id">
              {{ candidate.firstName }} {{ candidate.lastName }}
            </option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Sort By</label>
          <select class="form-select" [(ngModel)]="filter.sortBy" (change)="onFilterChange()">
            <option value="appliedDate">Applied Date</option>
            <option value="status">Status</option>
            <option value="jobId">Job</option>
            <option value="candidateId">Candidate</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Start Date</label>
          <input 
            type="date" 
            class="form-control" 
            [value]="filter.startDate ? (filter.startDate | date:'yyyy-MM-dd') : ''"
            (input)="onStartDateChange($any($event.target).value)"
          />
        </div>
        <div class="col-md-3">
          <label class="form-label">End Date</label>
          <input 
            type="date" 
            class="form-control" 
            [value]="filter.endDate ? (filter.endDate | date:'yyyy-MM-dd') : ''"
            (input)="onEndDateChange($any($event.target).value)"
          />
        </div>
        <div class="col-md-3">
          <label class="form-label">Sort Order</label>
          <select class="form-select" [(ngModel)]="filter.sortOrder" (change)="onFilterChange()">
            <option value="desc">Descending</option>
            <option value="asc">Ascending</option>
          </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
          <button class="btn btn-outline-secondary w-100" (click)="clearFilters()">
            <i class="bi bi-x-circle me-2"></i>Clear Filters
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
    {{ error }}
    <button type="button" class="btn-close" (click)="error = null"></button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Applications Table -->
  <div *ngIf="!loading && applications.length > 0" class="card">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th (click)="onSortChange('jobId')" style="cursor: pointer;">
                Job <i class="bi bi-arrow-down-up"></i>
              </th>
              <th (click)="onSortChange('candidateId')" style="cursor: pointer;">
                Candidate <i class="bi bi-arrow-down-up"></i>
              </th>
              <th (click)="onSortChange('status')" style="cursor: pointer;">
                Status <i class="bi bi-arrow-down-up"></i>
              </th>
              <th (click)="onSortChange('appliedDate')" style="cursor: pointer;">
                Applied Date <i class="bi bi-arrow-down-up"></i>
              </th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let application of applications">
              <td>
                <strong>{{ application.job?.title || getJobName(application.jobId) }}</strong>
                <br>
                <small class="text-muted">{{ application.job?.department }} - {{ application.job?.location }}</small>
              </td>
              <td>
                {{ application.candidate ? (application.candidate.firstName + ' ' + application.candidate.lastName) : getCandidateName(application.candidateId) }}
                <br>
                <small class="text-muted">{{ application.candidate?.email }}</small>
              </td>
              <td>
                <span [ngClass]="getStatusClass(application.status)">
                  {{ getStatusLabel(application.status) }}
                </span>
              </td>
              <td>{{ application.appliedDate | date:'short' }}</td>
              <td>
                <button class="btn btn-sm btn-primary" (click)="viewApplication(application.id)" title="View/Update Status">
                  <i class="bi bi-eye me-1"></i>View
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && applications.length === 0" class="card">
    <div class="card-body text-center py-5">
      <i class="bi bi-inbox" style="font-size: 3rem; color: #ccc;"></i>
      <p class="mt-3 text-muted">No applications found.</p>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="pagedResult && pagedResult.totalPages > 1" class="mt-4">
    <nav>
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="!pagedResult.hasPreviousPage">
          <a class="page-link" (click)="onPageChange((filter.pageNumber || 1) - 1)" [class.disabled]="!pagedResult.hasPreviousPage">
            Previous
          </a>
        </li>
        <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === (filter.pageNumber || 1)">
          <a class="page-link" (click)="onPageChange(page)">{{ page }}</a>
        </li>
        <li class="page-item" [class.disabled]="!pagedResult.hasNextPage">
          <a class="page-link" (click)="onPageChange((filter.pageNumber || 1) + 1)" [class.disabled]="!pagedResult.hasNextPage">
            Next
          </a>
        </li>
      </ul>
    </nav>
    <p class="text-center text-muted mt-2">
      Showing {{ ((filter.pageNumber || 1) - 1) * (filter.pageSize || 10) + 1 }} to 
      {{ (filter.pageNumber || 1) * (filter.pageSize || 10) > (pagedResult.totalCount) ? pagedResult.totalCount : (filter.pageNumber || 1) * (filter.pageSize || 10) }} 
      of {{ pagedResult.totalCount }} applications
    </p>
  </div>
</div>

